DROP TABLE USERLOGIN;
DROP TABLE USERDETAILS;
DROP TABLE ADMINLOGIN;
DROP TABLE PUBLISHER;
DROP TABLE AUTHOR;
DROP TABLE BOOKS;
DROP TABLE RATE;
DROP TABLE CATEGORY;

DROP TABLE BOOK_CAT;
DROP TABLE CATALOGUE;

DROP TABLE RATE;

DROP TABLE BILL;
DROP TABLE TRANSACTION;


CREATE TABLE USERLOGIN
(
USID VARCHAR(40) NOT NULL,
PWD VARCHAR(20),
PRIMARY KEY(USID)
);

CREATE TABLE ADMINLOGIN
(
ADMINID VARCHAR(40) NOT NULL,
PWD VARCHAR(20) ,
PRIMARY KEY(ADMINID)
);

CREATE TABLE PUBLISHER
(
PUBID VARCHAR(40) NOT NULL,
NAME VARCHAR(20),
CITY VARCHAR(20),
PRIMARY KEY(PUBID)
);

CREATE TABLE AUTHOR
(

AUTHORID VARCHAR(40) NOT NULL,
FIRSTNAME VARCHAR(20),
LASTNAME VARCHAR(20),
PRIMARY KEY(AUTHORID)
);


CREATE TABLE BOOKS
(
ISBN VARCHAR(20) NOT NULL ,
TITLE VARCHAR(20),
NO_OF_PAGES INTEGER,
COST_PRICE FLOAT,
EDITION VARCHAR(10),
YEAR INTEGER,
PUBID VARCHAR(40) NOT NULL,
DESCRIPTION VARCHAR(50),
RATING VARCHAR(10),
IMG VARCHAR(20),
PRIMARY KEY(ISBN),
FOREIGN KEY (PUBID) REFERENCES PUBLISHER(PUBID) ON DELETE NO ACTION
);


CREATE TABLE AUTH_BOOKS
(
ISBN VARCHAR(20) NOT NULL,
AUTHID VARCHAR(20)  NOT NULL,
PRIMARY KEY(ISBN,AUTHID),
FOREIGN KEY(AUTHID) REFERENCES AUTHOR(AUTHORID) ON DELETE NO ACTION,
FOREIGN KEY(ISBN) REFERENCES BOOKS(ISBN) ON DELETE NO ACTION


);


CREATE TABLE CATEGORY
(
CAT VARCHAR(20) NOT NULL,
NAME VARCHAR(40),
PRIMARY KEY(CAT)
);

CREATE TABLE BOOK_CAT
(
ISBN VARCHAR(40) NOT NULL,
CAT VARCHAR(20) NOT NULL,
PRIMARY KEY(ISBN,CAT),
FOREIGN KEY (ISBN) REFERENCES BOOKS(ISBN) ON DELETE NO ACTION,
FOREIGN KEY (CAT) REFERENCES CATEGORY(CAT) ON DELETE NO ACTION
);

CREATE TABLE CATALOGUE
(ISBN VARCHAR(40) NOT NULL,
ACQUIRED_DATE DATE NOT NULL,
NO_COPIES INTEGER,
PRIMARY KEY(ISBN,ACQUIRED_DATE)
);


CREATE TABLE RATE
(
ISBN VARCHAR(40) NOT NULL,
SP FLOAT NOT NULL,
DISCOUNT FLOAT,
PRIMARY KEY(ISBN),
FOREIGN KEY (ISBN) REFERENCES BOOKS(ISBN) ON DELETE NO ACTION
);
SELECT * FROM PUBLISHER

CREATE TABLE USERDETAILS
(
USID VARCHAR(40) NOT NULL,
FNAME VARCHAR(20),
LNAME VARCHAR(20),
MOBILE VARCHAR(15),
EMAIL VARCHAR(30),
ADDRESS VARCHAR(20),
CITY VARCHAR(20),
STATE VARCHAR(20),
COUNTRY VARCHAR(20),
GENDER VARCHAR(10),
TYPE_OF_USER CHAR(10),
PINCODE VARCHAR(10),
DOJ DATE,
PRIMARY KEY(USID),
FOREIGN KEY (USID) REFERENCES USERLOGIN(USID) ON DELETE CASCADE
);

CREATE TABLE BILL
(
BILLID VARCHAR(10) NOT NULL,
USID VARCHAR(40) NOT NULL,
BILL_DATE DATE,
TOTAL FLOAT,
PRIMARY KEY(BILLID),
FOREIGN KEY(USID) REFERENCES USERLOGIN(USID) ON delete NO ACTION 
);
DROP TABLE TRANSACTION;
CREATE TABLE TRANSACTION
(
BILLID VARCHAR(40) NOT NULL,
ISBN VARCHAR(40) NOT NULL,
QUANTITY INTEGER NOT NULL,
PRICE FLOAT,
DISCOUNT FLOAT,
PRIMARY KEY(BILLID,ISBN),`
FOREIGN KEY (ISBN) REFERENCES BOOKS(ISBN) ON DELETE NO ACTION,
FOREIGN KEY (BILLID) REFERENCES BILL(BILLID) ON DELETE NO ACTION

);

CREATE TABLE CART
(
ISBN VARCHAR(40) NOT NULL,
QUANTITY INTEGER NOT NULL,
PRIMARY KEY(ISBN),
FOREIGN KEY (ISBN) REFERENCES BOOKS(ISBN) ON DELETE NO ACTION

);

CREATE TABLE WISHLIST
(
USID VARCHAR(40) NOT NULL,
ISBN VARCHAR(40) NOT NULL,
PRIMARY KEY(USID,ISBN),
FOREIGN KEY (ISBN) REFERENCES BOOKS(ISBN) ON DELETE NO ACTION,
FOREIGN KEY (USID) REFERENCES USERLOGIN(USID) ON DELETE NO ACTION

);

DELETE FROM CART;
UPDATE CART SET QUANTITY=3 WHERE ISBN='A14'
INSERT INTO CATALOGUE VALUES('A1','2013-03-15',10);
INSERT INTO RATE VALUES('A1',250.0,56.0);
INSERT INTO RATE VALUES('A14',250.0,56.0);
INSERT INTO RATE VALUES('A15',250.0,56.0);
INSERT INTO RATE VALUES('A7',250.0,56.0);
INSERT INTO RATE VALUES('A9',250.0,56.0);
SELECT * FROM RATE WHERE DISCOUNT>=50;
SELECT * FROM CATALOGUE WHERE ACQUIRED_DATE BETWEEN current date-7 DAYS AND current date 
INSERT INTO USERLOGIN values('SRI','ABC');

UPDATE USERLOGIN SET PWD='XYZ' WHERE USID='SRI';
INSERT INTO USERLOGIN values('S','HTTP://@f.com');
INSERT into PUBLISHER VALUES('P1','HI','CHENNAI');
INSERT INTO BOOKS VALUES('A1','HARRY POTTER',200,20.0,'2',1994,'P1','ADFADF','3','11.jpeg');
INSERT INTO BOOKS VALUES('A2','HARRY POTTER',200,20.0,'2',1994,'P1','ADFADF','3','SFSDF');
INSERT INTO BOOKS VALUES('A3','HARRY POTTER',200,20.0,'2',1994,'P1','ADFADF','3','SFSDF');
INSERT INTO BOOKS VALUES('A5','HARRY POTTER',200,20.0,'2',1994,'P1','ADFADF','3','SFSDF');
INSERT INTO BOOKS VALUES('A6','HARRY POTTER',200,20.0,'2',1994,'P1','ADFADF','3','SFSDF');
INSERT INTO BOOKS VALUES('A7','HARRY POTTER',200,20.0,'2',1994,'P1','ADFADF','3','SFSDF');
INSERT INTO BOOKS VALUES('A8','HARRY POTTER',200,20.0,'2',1994,'P1','ADFADF','3','SFSDF');
INSERT INTO BOOKS VALUES('A9','HARRY POTTER',200,20.0,'2',1994,'P1','ADFADF','3','SFSDF');
INSERT INTO BOOKS VALUES('A10','HARRY POTTER',200,20.0,'2',1994,'P1','ADFADF','3','SFSDF');
INSERT INTO BOOKS VALUES('A11','HARRY POTTER',200,20.0,'2',1994,'P1','ADFADF','3','SFSDF');
INSERT INTO BOOKS VALUES('A12','HARRY POTTER',200,20.0,'2',1994,'P1','ADFADF','3','SFSDF');
INSERT INTO BOOKS VALUES('A13','HARRY POTTER',200,20.0,'2',1994,'P1','ADFADF','3','SFSDF');
INSERT INTO BOOKS VALUES('A4','HARRY',200,20.0,'2',1994,'P1','ADFADF','3','SFSDF');

INSERT INTO BOOKS VALUES('A14','HP1',200,20.0,'2',1994,'P1','ADFADF','3','11.jpeg');
INSERT INTO BOOKS VALUES('A15','HP1',200,20.0,'2',1994,'P1','ADFADF','5','11.jpeg');


INSERT INTO USERDETAILS VALUES('SRI','SRINI','FSF','4320','pdy@gmail.com','ac','sdfds','sdfsd','india','male','normal','6004','2013-03-20');
SELECT * FROM USERDETAILS WHERE USID='SRI'
UPDATE USERDETAILS SET FNAME='SFF',LNAME='SDFDS' WHERE USID='SRI'
SELECT * FROM BOOKS WHERE TITLE='HARRY POTTER';
SELECT * from USERLOGIN;
INSERT INTO AUTHOR VALUES('AU1','JK','ROWLING');
INSERT INTO AUTH_BOOKS VALUES('A1','AU1');
SELECT * FROM BOOKS WHERE ISBN=(SELECT ISBN FROM AUTH_BOOKS WHERE AUTHID=(SELECT AUTHID FROM AUTHOR WHERE FIRSTNAME='JK'));
SELECT * FROM BOOKS WHERE PUBID=(SELECT PUBID FROM PUBLISHER WHERE NAME='HI');
SELECT * from USERLOGIN;
SELECT * from BOOKS where RATING>=4.5;
INSERT INTO CATEGORY VALUES('C1','FICTION');
INSERT INTO BOOK_CAT VALUES('A1','C1');
SELECT * FROM WISHLIST;
DELETE FROM WISHLIST WHERE USID='SRI';
SELECT * FROM BOOKS WHERE ISBN=(SELECT ISBN FROM BOOK_CAT WHERE CAT=(SELECT CAT FROM CATEGORY WHERE NAME='FICTION'));
SELECT * FROM TRANSACTION
SELECT * FROM BILL
SELECT * from BOOKS
SELECT * from RATE
SELECT * from CATALOGUE
SELECT * FROM USERDETAILS
SELECT * FROM USERLOGIN
SELECT * from BOOK_CAT
INSERT INTO BOOK_CAT VALUES('A7','C1');
INSERT INTO BOOK_CAT VALUES('A14','C1');
INSERT INTO BOOK_CAT VALUES('A15','C1');
INSERT INTO BOOK_CAT VALUES('A11','C1');
INSERT INTO BOOK_CAT VALUES('A12','C1');
INSERT INTO BOOK_CAT VALUES('A13','C1');
SELECT TITLE FROM BOOKS WHERE EXISTS (SELECT ISBN FROM BOOK_CAT WHERE CAT='1')
SELECT CAT,COUNT(*) FROM BOOK_CAT WHERE EXISTS (SELECT ISBN from TRANSACTION WHERE EXISTS (SELECT BILLID FROM BILL WHERE USID='SRI'))  GROUP BY CAT ORDER BY 2 DESC 
SELECT * from AUTHOR
SELECT * FROM  AUTHOR
delete from AUTHOR WHERE AUTHORID='2'
insert into CATALOGUE VALUES('A14','2013-03-21',10)
UPDATE CATALOGUE SET NO_COPIES=NO_COPIES-2 WHERE ISBN='A14'
SELECT * FROM CATALOGUE
SELECT * FROM AUTH_BOOKS
SELECT * FROM AUTHOR
SELECT * FROM BOOKS WHERE ISBN IN (SELECT ISBN FROM BOOK_CAT WHERE CAT=(SELECT CAT FROM CATEGORY WHERE NAME='FICTION'))
SELECT * FROM BOOKS WHERE PUBID IN(SELECT PUBID FROM PUBLISHER WHERE NAME='kumudham')
select * FROM USERLOGIN
SELECT ISBN FROM AUTH_BOOKS WHERE AUTHID=(SELECT AUTHORID FROM AUTHOR WHERE FIRSTNAME='JK')